<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel="stylesheet" href="/style.css">
</head>

<body>
  <div class="container">
    <h1>SQLite Bread(Browse, Read, Edit, Add, Delete) and Pagination</h1>

    <!-- FILTER FORM -->
    <form action="/" method="GET" class="filter-form">
      <input type="hidden" name="page" value="1">

      <div class="form-group">
        <label>Name</label>
        <input type="text" name="string" placeholder="insert your name" value="<%= query.string || '' %>">
      </div>

      <div class="form-group">
        <label>Height</label>
        <input type="number" name="integer" placeholder="insert your height" value="<%= query.integer || '' %>">
      </div>

      <div class="form-group">
        <label>Weight</label>
        <input type="number" name="float" step="any" placeholder="insert your weight" value="<%= query.float || '' %>">
      </div>

      <div class="form-group">
        <label>Birth Date</label>
        <div class="date-range">
          <input type="date" name="startdate" value="<%= query.startdate || '' %>">
          <span>s.d.</span>
          <input type="date" name="enddate" value="<%= query.enddate || '' %>">
        </div>
      </div>

      <div class="form-group">
        <label>Is Married</label>
        <select name="boolean">
          <option value="">-select married-</option>
          <option value="true" <%=query.boolean==='true' ? 'selected' : '' %>>Yes</option>
          <option value="false" <%=query.boolean==='false' ? 'selected' : '' %>>Not Yet</option>
        </select>
      </div>

      <div class="form-group">
        <label>Operation</label>
        <div class="radio-group">
          <label><input type="radio" name="op" value="OR" <%=query.op==='OR' || !query.op ? 'checked' : '' %>>OR</label>
          <label><input type="radio" name="op" value="AND" <%=query.op==='AND' ? 'checked' : '' %>> AND</label>

        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-search">Search</button>
        <a href="/" class="btn btn-reset">Reset</a>
      </div>
    </form>

    <!-- DATA TABLE -->
    <div class="table-panel">
      <table>
        <thead>
          <tr>
            <th>No.</th>
            <th>Name</th>
            <th>Height</th>
            <th>Weight</th>
            <th>Birth Date</th>
            <th>Is Married</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% data.forEach((entry, index)=> { %>
            <tr class="<%= index % 2 === 0 ? 'even' : 'odd' %>">
              <td>
                <%= entry.id %>
              </td>
              <td>
                <%= entry.name %>
              </td>
              <td>
                <%= entry.height %>
              </td>
              <td>
                <%= entry.weight %>
              </td>
              <td>
                <%= entry.birthdate %>
              </td>
              <td>
                <%= entry.married==0 ? 'Not Yet' : 'Yes' %>
              </td>
              <td class="actions">
                <form action="/edit/<%= entry.id %>" method="GET" class="inline-form">
                  <button class="btn update">Update</button>
                </form>
                <form action="/delete/<%= entry.id %>" method="POST" class="inline-form"
                  onsubmit="return confirmDelete('<%= entry.name %>')">
                  <button type="submit" class="btn delete">Delete</button>
                </form>
              </td>
            </tr>
            <% }) %>
        </tbody>
      </table>
    </div>

    <!-- BOTTOM BAR (ADD + PAGINATION) -->
    <div class="bottom-bar">
      <div class="add-btn-container">
        <a href="/add" class="btn add">Add</a>
      </div>
      <div class="pagination">
        <% if (page> 1) { %>
          <a href="<%= url %>&page=<%= page - 1 %>">&laquo;</a>
          <% } %>
            <% for (let i=1; i <=totalPages; i++) { %>
              <a href="<%= url %>&page=<%= i %>" class="<%= page == i ? 'active' : '' %>">
                <%= i %>
              </a>
              <% } %>
                <% if (page < totalPages) { %>
                  <a href="<%= url %>&page=<%= page + 1 %>">&raquo;</a>
                  <% } %>
      </div>
    </div>

    <script>
      function confirmDelete(name) {
        return confirm(`Apakah kamu yakin akan menghapus data '${name}'?`);
      }
    </script>
</body>

</html>