<!DOCTYPE html>
<html lang="en">
<%- include('partials/head') %>

    <body id="page-top">
        <div id="wrapper">
            <%- include('partials/sidebar') %>
                <div id="content-wrapper" class="d-flex flex-column">
                    <div id="content">
                        <%- include('partials/topbar') %>
                            <div class="container-fluid">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h1 class="h3 text-gray-800 mb-0">Dashboard</h1>
                                    <a href="/dashboard/export-csv?<%= startdate ? `startdate=${startdate}` : '' %><%= enddate ? `&enddate=${enddate}` : '' %>"
                                        class="btn btn-primary">
                                        <i class="fas fa-file-csv"></i> Generate Report
                                    </a>
                                </div>
                                <form method="get" class="row g-3 mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div
                                                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                <h6 class="m-0 font-weight-bold text-primary">Date Settings</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row g-3">
                                                    <div class="col-12 col-md-6">
                                                        <label for="startdate" class="form-label">Start Date</label>
                                                        <input type="date" id="startdate" class="form-control"
                                                            name="startdate" value="<%= startdate || '' %>">
                                                    </div>
                                                    <div class="col-12 col-md-6">
                                                        <label for="enddate" class="form-label">End Date</label>
                                                        <input type="date" id="enddate" class="form-control"
                                                            name="enddate" value="<%= enddate || '' %>">
                                                    </div>
                                                    <div class="d-flex justify-content-start mt-2">
                                                        <button id="btnFinish" type="submit"
                                                            class="btn btn-success btn-icon-split mr-2">
                                                            <span class="icon text-white-50"><i
                                                                    class="fas fa-check"></i></span>
                                                            <span class="text">Query</span>
                                                        </button>
                                                        </div>
                                                        <div class="d-flex justify-content-start mt-2">
                                                        <a href="/dashboard" id="btnFinish" type="submit"
                                                            class="btn btn-warning btn-icon-split mr-2">
                                                            <span class="icon text-white-50"><i
                                                                    class="fas fa-arrow-left"></i></span>
                                                            <span class="text">Reset</span>
                                                            </a>
                                                    </div>
                                            </div>
                                        </div>
                                </form>

                                <div class="row text-center mb-4">
                                    <div class="col-md-3">
                                        <div class="card border-left-primary shadow py-2">
                                            <div class="card-body">
                                                <h5>Purchases</h5>
                                                <h4>Rp <%= totalExpense.toLocaleString('id-ID') %>
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card border-left-success shadow py-2">
                                            <div class="card-body">
                                                <h5>Sales</h5>
                                                <h4>Rp <%= totalRevenue.toLocaleString('id-ID') %>
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card border-left-warning shadow py-2">
                                            <div class="card-body">
                                                <h5>Earnings</h5>
                                                <h4>Rp <%= totalEarnings.toLocaleString('id-ID') %>
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card border-left-info shadow py-2">
                                            <div class="card-body">
                                                <h5>Total Sales</h5>
                                                <h4>
                                                    <%= totalSales %>
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>




                                <!-- Charts Row -->
                                <div class="row mb-4">
                                    <!-- Earnings Overview Line Chart -->
                                    <div class="col-xl-8 col-lg-7">
                                        <div class="card shadow mb-4">
                                            <div
                                                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                <h6 class="m-0 font-weight-bold text-primary">Earnings Overview</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-area">
                                                    <canvas id="earningsChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Revenue Source Pie Chart -->
                                    <div class="col-xl-4 col-lg-5">
                                        <div class="card shadow mb-4">
                                            <div
                                                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                <h6 class="m-0 font-weight-bold text-primary">Revenue Sources</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-pie pt-4 pb-2">
                                                    <canvas id="revenueChart"></canvas>
                                                </div>
                                                <div class="mt-4 text-center small">
                                                    <span class="mr-2">
                                                        <i class="fas fa-circle text-primary"></i> Direct
                                                    </span>
                                                    <span class="mr-2">
                                                        <i class="fas fa-circle text-success"></i> Customer
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <!-- Monthly Revenue Table -->
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Monthly Revenue Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="dashboardTable" class="table table-bordered" width="100%"
                                                cellspacing="0">
                                                <thead>
                                                    <tr>
                                                        <th>Monthly</th>
                                                        <th>Expense</th>
                                                        <th>Revenue</th>
                                                        <th>Earnings</th>
                                                    </tr>
                                                </thead>
                                                <tfoot>
                                                    <tr>
                                                        <th>Total</th>
                                                        <th>Rp <%= totalExpense.toLocaleString('id-ID') %>
                                                        </th>
                                                        <th>Rp <%= totalRevenue.toLocaleString('id-ID') %>
                                                        </th>
                                                        <th>Rp <%= totalEarnings.toLocaleString('id-ID') %>
                                                        </th>
                                                    </tr>
                                                </tfoot>
                                                <tbody>
                                                    <% if (monthly.length===0) { %>
                                                        <tr>
                                                            <td colspan="4" class="text-center">No data available</td>
                                                        </tr>
                                                        <% } else { %>
                                                            <% monthly.forEach(row=> { %>
                                                                <tr data-sort="<%= row.yearmonth %>">
                                                                    <td>
                                                                        <%= row.month %>
                                                                    </td>
                                                                    <td>Rp <%=
                                                                            Number(row.expense).toLocaleString('id-ID')
                                                                            %>
                                                                    </td>
                                                                    <td>Rp <%=
                                                                            Number(row.revenue).toLocaleString('id-ID')
                                                                            %>
                                                                    </td>
                                                                    <td>Rp <%=
                                                                            Number(row.earnings).toLocaleString('id-ID')
                                                                            %>
                                                                    </td>
                                                                </tr>
                                                                <% }) %>
                                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>
                    </div>
                </div>
                <%- include('partials/footer') %>
        </div>
    </body>

</html>