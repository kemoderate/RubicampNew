<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
  <h1>
    <%= title %>
  </h1>

  <% if (error_msg) { %>
    <div style="color: red;">
      <%= error_msg %>
    </div>
    <% } %>

      <form action="/" method="GET" class="filter-form">
        <input type="hidden" name="page" value="1">

        <div class="form-group">
          <label>Title</label>
          <input type="text" name="string" placeholder="insert your name" value="<%= query.string || '' %>">
        </div>

        <div class="form-group">
          <label>Deadline </label>
          <div class="date-range">
            <input type="date" name="startdate" value="<%= query.startdate || '' %>">
            <span>s.d.</span>
            <input type="date" name="enddate" value="<%= query.enddate || '' %>">
          </div>
        </div>

        <div class="form-group">
          <label>Complete</label>
          <select name="boolean">
            <option value="">-select complete-</option>
            <option value="true" <%=query.boolean==='true' ? 'selected' : '' %>>Yes</option>
            <option value="false" <%=query.boolean==='false' ? 'selected' : '' %>>Not Yet</option>
          </select>
        </div>

        <div class="form-group">
          <label>Operation</label>
          <div class="radio-group">
            <label><input type="radio" name="op" value="OR" <%=query.op==='OR' || !query.op ? 'checked' : ''
                %>>OR</label>
            <label><input type="radio" name="op" value="AND" <%=query.op==='AND' ? 'checked' : '' %>> AND</label>

          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-search">Search</button>
          <a href="/" class="btn btn-reset">Reset</a>
        </div>
      </form>

      <div class="table-panel">
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Title</th>
              <th>Complete</th>
              <th>Deadline</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% data.forEach((entry, index)=> { %>
              <tr class="<%= index % 2 === 0 ? 'even' : 'odd' %>">
                <td>
                  <%= entry.id %>
                </td>
                <td>
                  <%= entry.title %>
                </td>
                <td>
                  <%= entry.complete ? 'Yes' : 'No' %>
                </td>
                <td>
                  <%= entry.deadline ? entry.deadline.toISOString().split('T')[0] : '' %>
                </td>
                <td class="actions">
                  <form action="/edit/<%= entry.id %>" method="GET" class="inline-form">
                    <button class="btn update">Update</button>
                  </form>
                  <form action="/delete/<%= entry.id %>" method="POST" class="inline-form"
                    onsubmit="return confirmDelete('<%= entry.title %>')">
                    <button type="submit" class="btn delete">Delete</button>
                  </form>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>

      <script>
        function confirmDelete(title) {
          return confirm(`Yakin mau hapus "${title}"?`);
        }
      </script>
</body>

</html>