<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/stylesheets/style.css">

</head>

<body>
  <% if (error_msg) { %>
    <div style="color: red;">
      <%= error_msg %>
    </div>
    <% } %>


      <% if (user) { %>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h1 class="h3 m-0">
            <%= title %>
          </h1>
          
          <form action="/logout" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-dark">
              <i class="fa fa-sign-out"></i> Sign Out
            </button>
            </form>
        </div>

        <div class="user-info">
          <li class="nav-item me-2">
            <a href="/users/avatar">
              <% if (user.avatar) { %>
                <img src="/uploads/<%= user.avatar %>" alt="Avatar" class="rounded-circle" width="40" height="40">
              <% } else { %>
                <img src="/images/default-avatar.png" alt="Avatar" class="rounded-circle" width="40" height="40">
              <% } %>
            </a>
          </li>
          <span class="user-email">
            <%= user.email %>
          </span>
        </div>

        <% } %>
          </div>


          <form action="/" method="GET" class="filter-form">
            <input type="hidden" name="page" value="1">

            <div class="form-group">
              <label>Title</label>
              <input type="text" name="string" placeholder="insert your name" value="<%= query.string || '' %>">
            </div>

            <div class="form-group">
              <label>Deadline </label>
              <div class="date-range">
                <input type="date" name="startdate" value="<%= query.startdate || '' %>">
                <span>s.d.</span>
                <input type="date" name="enddate" value="<%= query.enddate || '' %>">
              </div>


              <div class="form-group">
                <label>Complete</label>
                <select name="boolean">
                  <option value="">-select complete-</option>
                  <option value="true" <%=query.boolean==='true' ? 'selected' : '' %>>Yes</option>
                  <option value="false" <%=query.boolean==='false' ? 'selected' : '' %>>Not Yet</option>
                </select>
              </div>

              <div class="form-group">
                <label>Operation</label>
                <div class="radio-group">
                  <label><input type="radio" name="op" value="OR" <%=query.op==='OR' || !query.op ? 'checked' : ''
                      %>>OR</label>
                  <label><input type="radio" name="op" value="AND" <%=query.op==='AND' ? 'checked' : '' %>> AND</label>

                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-search">Search</button>
                <a href="/" class="btn btn-reset">Reset</a>
              </div>
          </form>

          <div class="table-panel">
            <table>
              <thead>
                <tr>
                  <th>No</th>
                  <th>Title</th>
                  <th>Complete</th>
                  <th>Deadline</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% data.forEach((entry, index)=> { %>
                  <tr class="<%= index % 2 === 0 ? 'even' : 'odd' %>">
                    <td>
                      <%= entry.nomor_urut %>
                    </td>
                    <td style="display:none;">
                      <%= entry.id %>
                    </td>
                    <td>
                      <%= entry.title %>
                    </td>
                    <td>
                      <%= entry.complete ? 'Yes' : 'No' %>
                    </td>
                    <td>
                      <%= entry.deadline ? entry.deadline.toISOString().split('T')[0] : '' %>
                    </td>
                    <td class="actions">
                      <form action="/edit/<%= entry.id %>" method="GET" class="inline-form">
                        <button class="btn update">Update</button>
                      </form>
                      <form action="/delete/<%= entry.id %>" method="POST" class="inline-form"
                        onsubmit="return confirmDelete('<%= entry.title %>')">
                        <button type="submit" class="btn delete">Delete</button>
                      </form>
                    </td>
                  </tr>
                  <% }) %>
              </tbody>
            </table>
          </div>

          <div class="bottom-bar">
            <div class="add-btn-container">
              <a href="/add" class="btn add">Add</a>
            </div>
            <div class="pagination">
              <% if (page> 1) { %>
                <a href="<%= url %>&page=<%= page - 1 %>">&laquo;</a>
                <% } %>
                  <% for (let i=1; i <=totalPages; i++) { %>
                    <a href="<%= url %>&page=<%= i %>" class="<%= page == i ? 'active' : '' %>">
                      <%= i %>
                    </a>
                    <% } %>
                      <% if (page < totalPages) { %>
                        <a href="<%= url %>&page=<%= page + 1 %>">&raquo;</a>
                        <% } %>
            </div>
          </div>


          <script>
            function confirmDelete(title) {
              return confirm(`Yakin mau hapus "${title}"?`);
            }
          </script>
</body>

</html>